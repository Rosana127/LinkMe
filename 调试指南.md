# 前端API接口调试指南

## 问题描述
队友无法在前端正常登录和展示帖子，但你的电脑上可以正常使用。

## 快速诊断步骤

### 1. 检查后端服务是否运行

**最重要的一步！**

```bash
# 检查后端服务是否在 localhost:8080 运行
# 可以在浏览器中访问：http://localhost:8080
# 或者使用 curl 命令：
curl http://localhost:8080
```

**如果后端服务未运行：**
- 启动后端服务
- 确认后端服务运行在 `localhost:8080` 端口
- 如果后端运行在其他端口，需要修改 `vite.config.js` 中的代理配置

### 2. 检查浏览器控制台

1. 打开浏览器开发者工具（F12）
2. 切换到 **Console** 标签
3. 查看是否有错误信息
4. 查看是否有 `[API Request]` 和 `[API Response]` 日志（开发环境下会显示）

**常见的错误信息：**
- `ERR_CONNECTION_REFUSED` - 后端服务未运行
- `401 Unauthorized` - Token无效或已过期
- `404 Not Found` - 接口路径错误
- `CORS error` - 跨域问题（虽然通过代理应该不会有）

### 3. 检查Network标签

1. 打开浏览器开发者工具（F12）
2. 切换到 **Network** 标签
3. 刷新页面或执行操作（登录、获取帖子等）
4. 查看请求详情：
   - **请求URL**: 应该是 `http://localhost:3000/api/...`
   - **请求方法**: GET/POST等
   - **状态码**: 200（成功）、401（未授权）、404（未找到）、500（服务器错误）等
   - **请求头**: 查看是否有 `Authorization: Bearer ...` header
   - **响应内容**: 查看后端返回的数据

### 4. 检查LocalStorage

1. 打开浏览器开发者工具（F12）
2. 切换到 **Application** 标签（Chrome）或 **Storage** 标签（Firefox）
3. 展开 **Local Storage**
4. 检查是否存在以下键：
   - `token` - 认证令牌
   - `user` - 用户信息

**如果token不存在或为空：**
- 重新登录
- 检查登录接口是否正常返回token

**如果token存在但请求仍然失败：**
- Token可能已过期
- 重新登录获取新的token

### 5. 检查代理配置

查看 `vite.config.js` 文件：

```javascript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8080',  // 确认后端服务地址
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, '')
    }
  }
}
```

**确认：**
- 后端服务地址是否正确（`localhost:8080`）
- 如果后端运行在其他端口，需要修改 `target` 值
- 重启前端开发服务器使配置生效

### 6. 测试API连接

使用 Postman 或 curl 直接测试后端API：

```bash
# 测试获取帖子列表（需要先登录获取token）
curl -X GET http://localhost:8080/posts \
  -H "Authorization: Bearer YOUR_TOKEN"

# 测试登录接口
curl -X POST http://localhost:8080/user/login \
  -H "Content-Type: application/json" \
  -d '{"loginName":"your_email","password":"your_password"}'
```

## 常见问题解决方案

### 问题1: 后端服务未运行

**症状：**
- 浏览器控制台显示 `ERR_CONNECTION_REFUSED`
- Network标签中请求状态为 `failed` 或 `pending`

**解决方案：**
1. 启动后端服务
2. 确认后端服务运行在 `localhost:8080`
3. 测试后端服务是否正常：访问 `http://localhost:8080`

### 问题2: Token无效或已过期

**症状：**
- 浏览器控制台显示 `401 Unauthorized`
- Network标签中请求状态码为 `401`
- 请求Headers中没有 `Authorization` header 或token为空

**解决方案：**
1. 清除LocalStorage中的token和user
2. 重新登录
3. 检查登录接口是否正常返回token
4. 检查token是否过期（如果后端实现了token过期机制）

### 问题3: 代理配置错误

**症状：**
- 请求发送到错误的地址
- Network标签中请求URL不正确

**解决方案：**
1. 检查 `vite.config.js` 中的代理配置
2. 确认后端服务地址和端口
3. 重启前端开发服务器

### 问题4: 环境差异

**症状：**
- 你的电脑上正常，队友的电脑上不正常
- 可能是端口号、服务地址等配置不同

**解决方案：**
1. 对比 `vite.config.js` 配置
2. 检查是否有 `.env` 文件，内容是否一致
3. 确认后端服务地址是否一致
4. 使用环境变量统一配置

## 使用环境变量（推荐）

创建 `.env` 文件：

```env
VITE_API_BASE_URL=http://localhost:8080
```

修改 `vite.config.js`：

```javascript
import { defineConfig, loadEnv } from 'vite'

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd(), '')
  
  return {
    // ... 其他配置
    server: {
      proxy: {
        '/api': {
          target: env.VITE_API_BASE_URL || 'http://localhost:8080',
          changeOrigin: true,
          rewrite: (path) => path.replace(/^\/api/, '')
        }
      }
    }
  }
})
```

## 调试技巧

### 1. 启用详细日志

代码中已经添加了开发环境下的详细日志，在浏览器控制台可以看到：
- `[API Request]` - 请求详情
- `[API Response]` - 响应详情
- `[API Error]` - 错误详情

### 2. 使用断点调试

在 `src/api/request.js` 中设置断点，查看请求和响应的详细信息。

### 3. 检查后端日志

查看后端服务器的日志，确认：
- 请求是否到达后端
- 后端是否正常处理请求
- 是否有错误信息

## 联系支持

如果以上方法都无法解决问题，请提供以下信息：
1. 浏览器控制台的错误信息
2. Network标签中请求的详细信息
3. 后端服务器的日志
4. 环境配置信息（vite.config.js、.env等）


