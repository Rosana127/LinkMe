# 调试步骤

本文档提供详细的调试步骤和检查清单。

> 🔍 遇到具体问题？查看 [问题排查指南](./问题排查指南.md)  
> 📋 需要检查接口实现？查看 [API 接口检查](./API接口检查.md)

## 快速诊断步骤

### 1. 检查后端服务是否运行

**最重要的一步！**

```bash
# 检查后端服务是否在 localhost:8080 运行
# 可以在浏览器中访问：http://localhost:8080
# 或者使用 curl 命令：
curl http://localhost:8080
```

**如果后端服务未运行：**

- 启动后端服务
- 确认后端服务运行在 `localhost:8080` 端口
- 如果后端运行在其他端口，需要修改 `vite.config.js` 中的代理配置

### 2. 检查浏览器控制台

1. 打开浏览器开发者工具（F12）
2. 切换到 **Console** 标签
3. 查看是否有错误信息
4. 查看是否有 `[API Request]` 和 `[API Response]` 日志（开发环境下会显示）

**常见的错误信息：**

- `ERR_CONNECTION_REFUSED` - 后端服务未运行（参考 [问题排查指南 - 后端服务未启动](./问题排查指南.md#最可能的原因1后端服务未启动或无法访问)）
- `401 Unauthorized` - Token 无效或已过期（参考 [问题排查指南 - Token 认证问题](./问题排查指南.md#原因2token认证问题)）
- `404 Not Found` - 接口路径错误
- `CORS error` - 跨域问题（虽然通过代理应该不会有）

### 3. 检查 Network 标签

1. 打开浏览器开发者工具（F12）
2. 切换到 **Network** 标签
3. 刷新页面或执行操作（登录、获取帖子等）
4. 查看请求详情：
   - **请求 URL**: 应该是 `http://localhost:3000/api/...`
   - **请求方法**: GET/POST 等
   - **状态码**: 200（成功）、401（未授权）、404（未找到）、500（服务器错误）等
   - **请求头**: 查看是否有 `Authorization: Bearer ...` header
   - **响应内容**: 查看后端返回的数据

### 4. 检查 LocalStorage

1. 打开浏览器开发者工具（F12）
2. 切换到 **Application** 标签（Chrome）或 **Storage** 标签（Firefox）
3. 展开 **Local Storage**
4. 检查是否存在以下键：
   - `token` - 认证令牌
   - `user` - 用户信息

**如果 token 不存在或为空：**

- 重新登录
- 检查登录接口是否正常返回 token

**如果 token 存在但请求仍然失败：**

- Token 可能已过期
- 重新登录获取新的 token
- 参考 [问题排查指南 - Token 认证问题](./问题排查指南.md#原因2token认证问题)

### 5. 检查代理配置

查看 `vite.config.js` 文件：

```javascript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8080',  // 确认后端服务地址
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, '')
    }
  }
}
```

**确认：**

- 后端服务地址是否正确（`localhost:8080`）
- 如果后端运行在其他端口，需要修改 `target` 值
- 重启前端开发服务器使配置生效

### 6. 测试 API 连接

使用 Postman 或 curl 直接测试后端 API：

```bash
# 测试获取帖子列表（需要先登录获取token）
curl -X GET http://localhost:8080/posts \
  -H "Authorization: Bearer YOUR_TOKEN"

# 测试登录接口
curl -X POST http://localhost:8080/user/login \
  -H "Content-Type: application/json" \
  -d '{"loginName":"your_email","password":"your_password"}'
```

## 调试技巧

### 1. 启用详细日志

代码中已经添加了开发环境下的详细日志，在浏览器控制台可以看到：

- `[API Request]` - 请求详情
- `[API Response]` - 响应详情
- `[API Error]` - 错误详情

### 2. 使用断点调试

在 `src/api/request.js` 中设置断点，查看请求和响应的详细信息。

### 3. 检查后端日志

查看后端服务器的日志，确认：

- 请求是否到达后端
- 后端是否正常处理请求
- 是否有错误信息

## 快速检查清单

- [ ] 后端服务是否在 `localhost:8080` 运行？
- [ ] 浏览器控制台是否有错误信息？
- [ ] Network 标签中请求是否发出？
- [ ] 请求的响应状态码是什么？（200/401/404/500 等）
- [ ] LocalStorage 中是否有 token？
- [ ] Token 是否有效（未过期）？
- [ ] 请求 Headers 中是否有 Authorization header？
- [ ] 代理配置是否正确？
- [ ] 后端 CORS 配置是否正确？
